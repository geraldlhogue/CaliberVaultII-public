2025-11-09 18:03:42 [tests] start

added 904 packages in 25s

 RUN  v2.1.9 /Users/ghogue/Desktop/CaliberVaultII

 × src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > saveItem > saves firearm item successfully
   → Cannot read properties of null (reading 'id')
 × src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > saveItem > saves ammunition item successfully
   → Cannot read properties of null (reading 'id')
 ✓ src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > saveItem > throws error for invalid category
 × src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > getItems > retrieves all items for user
   → expected [] to deeply equal [ …(2) ]
 ✓ src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > getItems > returns empty array when no items found
 ✓ src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > updateItem > updates item successfully
 ✓ src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > valuation methods > saves valuation successfully
 ✓ src/services/__tests__/inventory.service.enhanced.test.ts > InventoryService - Enhanced Tests > valuation methods > gets valuation history
stdout | src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > FirearmsService > should create firearm using createFirearm
[firearm_detailsService] Creating: {
  baseData: {
    name: 'Test Rifle',
    manufacturer_id: 'mfg123',
    model: 'TR-15',
    quantity: 1,
    purchase_date: undefined,
    purchase_price: undefined,
    current_value: undefined,
    storage_location_id: undefined,
    notes: undefined,
    image_url: undefined
  },
  detailData: {
    firearm_type_id: undefined,
    serial_number: '123456',
    caliber_id: 'cal123',
    cartridge_id: undefined,
    barrel_length: undefined,
    overall_length: undefined,
    weight: undefined,
    capacity: undefined,
    action_id: undefined,
    finish: undefined,
    round_count: undefined,
    is_nfa: undefined,
    nfa_item_type: undefined,
    form_4_approved_date: undefined,
    tax_stamp_number: undefined
  }
}

stdout | src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > AmmunitionService > should create ammunition using createAmmunition
[ammunition_detailsService] Creating: {
  baseData: {
    name: 'Test Ammo',
    manufacturer_id: 'mfg123',
    model: undefined,
    quantity: 1,
    purchase_date: undefined,
    purchase_price: undefined,
    current_value: undefined,
    storage_location_id: undefined,
    notes: undefined,
    image_url: undefined
  },
  detailData: {
    caliber_id: 'cal123',
    cartridge_id: undefined,
    bullet_type_id: undefined,
    bullet_weight: undefined,
    muzzle_velocity: undefined,
    rounds_per_box: undefined,
    is_reloaded: undefined,
    brass_condition: undefined
  }
}

 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > FirearmsService > should create firearm using createFirearm
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > FirearmsService > should update firearm using updateFirearm
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > FirearmsService > should delete firearm
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > FirearmsService > should get firearm by id
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > AmmunitionService > should create ammunition using createAmmunition
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > AmmunitionService > should update ammunition using updateAmmunition
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > AmmunitionService > should delete ammunition
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > OpticsService > should create optic using createOptic
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > OpticsService > should update optic using updateOptic
 ✓ src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > OpticsService > should delete optic
stdout | src/services/__tests__/categoryServices.comprehensive.test.ts > Category Services - Comprehensive Tests > OpticsService > should create optic using createOptic
[optic_detailsService] Creating: {
  baseData: {
    name: 'Test Scope',
    quantity: 1,
    purchase_date: undefined,
    purchase_price: undefined,
    current_value: undefined,
    storage_location_id: undefined,
    notes: undefined,
    image_url: undefined
  },
  detailData: {
    manufacturer_id: 'mfg123',
    model: 'SC-4X',
    magnification: '4x',
    objective_lens: undefined,
    reticle_type_id: undefined,
    turret_type_id: undefined,
    mounting_type_id: undefined,
    fov_id: undefined
  }
}

 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > returns all items when no filters applied
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > filters by category
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > filters by search query
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > filters by caliber
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > returns unique calibers
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > returns unique manufacturers
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > calculates max price correctly
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > handles empty inventory gracefully
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > filters with advanced price range
 ✓ src/hooks/__tests__/useInventoryFilters.test.ts > useInventoryFilters > calculates active filter count
 ✓ src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Barcode Validation > validates UPC-A format (12 digits)
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Barcode Validation > validates UPC-E format (13 digits)
   → expected false to be true // Object.is equality
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Barcode Validation > rejects invalid UPC formats
   → expected true to be false // Object.is equality
 ✓ src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Barcode Validation > validates EAN-13 format
 ✓ src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Barcode Validation > rejects invalid EAN formats
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Barcode Validation > detects barcode types correctly
   → expected 'UNKNOWN' to be 'EAN-8' // Object.is equality
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Offline Mode > handles offline barcode lookup gracefully
   → expected { success: true, data: {} } to have property "source"
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Offline Mode > returns cache miss when barcode not cached
   → expected true to be false // Object.is equality
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > API Usage Tracking > tracks API call count
   → service.getApiUsage is not a function
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > API Usage Tracking > resets API counter
   → service.resetApiCounter is not a function
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Cache Management > gets cache statistics
   → service.getCacheStats is not a function
 × src/services/__tests__/barcode.service.comprehensive.test.ts > BarcodeService - Comprehensive Tests > Cache Management > clears cache
   → service.clearCache is not a function
 ✓ src/test/integration/data-migration.test.ts > Data Migration Validation > should have ammunition table with correct schema
 ✓ src/test/integration/data-migration.test.ts > Data Migration Validation > should have bullets table with correct schema
 ✓ src/test/integration/data-migration.test.ts > Data Migration Validation > should have magazines table
 ✓ src/test/integration/data-migration.test.ts > Data Migration Validation > should have accessories table
 × src/test/integration/data-migration.test.ts > Data Migration Validation > should fetch all categories from categories table
   → expected 0 to be greater than or equal to 12
 × src/test/integration/data-migration.test.ts > Data Migration Validation > should create ammunition item successfully
   → expected undefined to be 'Test Ammo' // Object.is equality
 × src/test/integration/data-migration.test.ts > Data Migration Validation > should create magazine item successfully
   → expected undefined to be 30 // Object.is equality
 × src/services/inventory/__tests__/BatchOperationsService.test.ts > BatchOperationsService > bulkCreate > should create multiple items successfully
   → [vitest] No "ammunitionService" export is defined on the "../../category" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/services/inventory/__tests__/BatchOperationsService.test.ts > BatchOperationsService > bulkCreate > should handle partial failures
   → [vitest] No "ammunitionService" export is defined on the "../../category" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/services/inventory/__tests__/BatchOperationsService.test.ts > BatchOperationsService > bulkDelete > should delete multiple items
   → [vitest] No "ammunitionService" export is defined on the "../../category" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 × src/services/inventory/__tests__/BatchOperationsService.test.ts > BatchOperationsService > bulkDuplicate > should duplicate items
   → [vitest] No "ammunitionService" export is defined on the "../../category" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

 ✓ src/components/__tests__/PhotoCapture.test.tsx > PhotoCapture > renders photo capture dialog
 ✓ src/components/__tests__/PhotoCapture.test.tsx > PhotoCapture > calls onClose when close button clicked
 ✓ src/components/__tests__/PhotoCapture.test.tsx > PhotoCapture > initializes camera on mount
 × src/test/integration/api.test.ts > API Integration Tests > REST API Endpoints > fetches inventory items via API
   → apiService.getAll is not a function
 × src/test/integration/api.test.ts > API Integration Tests > REST API Endpoints > creates item via API
   → expected { success: true, data: { id: '1' } } to deeply equal { name: 'New Item', …(1) }
 × src/test/integration/api.test.ts > API Integration Tests > REST API Endpoints > handles API errors gracefully
   → apiService.getAll is not a function
 × src/test/integration/api.test.ts > API Integration Tests > Real-time Subscriptions > subscribes to inventory changes
   → apiService.subscribeToChanges is not a function
 × src/test/integration/api.test.ts > API Integration Tests > Batch Operations > performs batch insert
   → apiService.batchCreate is not a function
stdout | src/test/integration/comprehensive-categories.test.ts > Comprehensive Category Integration Tests > Firearms Service Integration > creates firearm with all fields
[firearm_detailsService] Creating: {
  baseData: {
    name: 'Test Rifle',
    manufacturer: 'Test Mfg',
    model: 'TR-15',
    caliber: '5.56mm',
    serial_number: 'TEST123',
    action_type: 'Semi-Auto',
    barrel_length: 16,
    overall_length: 36,
    weight: 7.5,
    capacity: 30
  },
  detailData: undefined
}

stdout | src/test/integration/comprehensive-categories.test.ts > Comprehensive Category Integration Tests > Ammunition Service Integration > creates ammunition with specifications
[ammunition_detailsService] Creating: {
  baseData: {
    name: 'Test Ammo',
    manufacturer: 'Test Ammo Co',
    caliber: '5.56mm',
    grain_weight: 55,
    bullet_type: 'FMJ',
    quantity: 1000,
    rounds_per_box: 20
  },
  detailData: undefined
}

 × src/test/integration/comprehensive-categories.test.ts > Comprehensive Category Integration Tests > Firearms Service Integration > creates firearm with all fields
   → Failed to create inventory item: Error occurred
 × src/test/integration/comprehensive-categories.test.ts > Comprehensive Category Integration Tests > Ammunition Service Integration > creates ammunition with specifications
   → Failed to create inventory item: Error occurred
 ✓ src/test/integration/comprehensive-categories.test.ts > Comprehensive Category Integration Tests > Cross-Category Operations > links firearm with compatible ammunition
 ✓ src/services/__tests__/team.service.test.ts > TeamService > should create team
 ✓ src/services/__tests__/team.service.test.ts > TeamService > should add team member
 ✓ src/services/__tests__/team.service.test.ts > TeamService > should list team members
 ✓ src/services/__tests__/team.service.test.ts > TeamService > should remove team member
 ✓ src/services/__tests__/team.service.test.ts > TeamService > should get teams
 ✓ src/services/__tests__/team.service.test.ts > TeamService > should update team
 ✓ src/services/__tests__/team.service.test.ts > TeamService > should delete team
 ✓ src/services/__tests__/barcode.service.test.ts > BarcodeService > should validate UPC format
 ✓ src/services/__tests__/barcode.service.test.ts > BarcodeService > should validate EAN format
 ✓ src/services/__tests__/barcode.service.test.ts > BarcodeService > should detect barcode type
 ✓ src/services/__tests__/barcode.service.test.ts > BarcodeService > should track API usage
 ✓ src/services/__tests__/barcode.service.test.ts > BarcodeService > should reset API counter
stdout | src/services/__tests__/sync.service.test.ts > SyncService > should process queue successfully
[SyncService] Sync complete: { success: 0, failed: 0, conflicts: 0 }

 ✓ src/services/__tests__/sync.service.test.ts > SyncService > should process queue successfully
 ✓ src/services/__tests__/sync.service.test.ts > SyncService > should subscribe to sync status updates
 ✓ src/services/__tests__/sync.service.test.ts > SyncService > should not process queue if already processing
stdout | src/services/__tests__/sync.service.test.ts > SyncService > should not process queue if already processing
[SyncService] Sync already in progress

 ✓ src/services/inventory/__tests__/ModalIntegrationService.test.ts > ModalIntegrationService > saveItem > should route firearms to firearmsService
 ✓ src/services/inventory/__tests__/ModalIntegrationService.test.ts > ModalIntegrationService > saveItem > should route ammunition to ammunitionService
 ✓ src/services/inventory/__tests__/ModalIntegrationService.test.ts > ModalIntegrationService > updateItem > should update firearms correctly
stdout | src/services/__tests__/categoryServices.test.ts > FirearmsService > should create a firearm using createFirearm method
[firearm_detailsService] Creating: {
  baseData: {
    name: 'Test Rifle',
    manufacturer_id: 'mfg123',
    model: 'TR-15',
    quantity: 1,
    purchase_date: undefined,
    purchase_price: undefined,
    current_value: undefined,
    storage_location_id: undefined,
    notes: undefined,
    image_url: undefined
  },
  detailData: {
    firearm_type_id: undefined,
    serial_number: '123456',
    caliber_id: 'cal123',
    cartridge_id: undefined,
    barrel_length: undefined,
    overall_length: undefined,
    weight: undefined,
    capacity: undefined,
    action_id: undefined,
    finish: undefined,
    round_count: undefined,
    is_nfa: undefined,
    nfa_item_type: undefined,
    form_4_approved_date: undefined,
    tax_stamp_number: undefined
  }
}

stdout | src/services/__tests__/categoryServices.test.ts > AmmunitionService > should create ammunition using createAmmunition method
[ammunition_detailsService] Creating: {
  baseData: {
    name: 'Test Ammo',
    manufacturer_id: 'mfg123',
    model: undefined,
    quantity: 1,
    purchase_date: undefined,
    purchase_price: undefined,
    current_value: undefined,
    storage_location_id: undefined,
    notes: undefined,
    image_url: undefined
  },
  detailData: {
    caliber_id: 'cal123',
    cartridge_id: undefined,
    bullet_type_id: undefined,
    bullet_weight: undefined,
    muzzle_velocity: undefined,
    rounds_per_box: undefined,
    is_reloaded: undefined,
    brass_condition: undefined
  }
}

 × src/services/__tests__/categoryServices.test.ts > FirearmsService > should create a firearm using createFirearm method
   → Failed to create inventory item: undefined
 × src/services/__tests__/categoryServices.test.ts > FirearmsService > should update a firearm using updateFirearm method
   → supabase.from(...).update is not a function
 × src/services/__tests__/categoryServices.test.ts > AmmunitionService > should create ammunition using createAmmunition method
   → Failed to create inventory item: undefined
 ✓ src/services/__tests__/inventory.service.test.ts > InventoryService > should save firearm item
 ✓ src/services/__tests__/inventory.service.test.ts > InventoryService > should handle lowercase category names
 ✓ src/lib/__tests__/barcodeCache.test.ts > BarcodeCacheManager > initializes cache manager
 × src/lib/__tests__/barcodeCache.test.ts > BarcodeCacheManager > caches barcode data 30001ms
   → Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 × src/lib/__tests__/barcodeCache.test.ts > BarcodeCacheManager > retrieves cached data 30001ms
   → Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 × src/lib/__tests__/barcodeCache.test.ts > BarcodeCacheManager > returns null for non-existent barcode 30001ms
   → Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 × src/lib/__tests__/barcodeCache.test.ts > BarcodeCacheManager > clears all cache 30001ms
   → Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 × src/utils/__tests__/csvValidator.test.ts > csvValidator > validateCSVRow > validates row with all required fields
   → Cannot convert undefined or null to object
 × src/utils/__tests__/csvValidator.test.ts > csvValidator > validateCSVRow > rejects row with missing required fields
   → Cannot convert undefined or null to object
 × src/utils/__tests__/csvValidator.test.ts > csvValidator > validateCSVRow > validates numeric fields
   → expected undefined to be false // Object.is equality
 × src/utils/__tests__/csvValidator.test.ts > csvValidator > validateCSVHeaders > validates correct headers
   → validateCSVHeaders is not a function
 × src/utils/__tests__/csvValidator.test.ts > csvValidator > validateCSVHeaders > rejects missing required headers
   → validateCSVHeaders is not a function
stdout | src/services/category/__tests__/FirearmsService.test.ts > FirearmsService > should create firearm with correct fields
[firearm_detailsService] Creating: {
  baseData: { name: 'Test Rifle', manufacturer_id: 'mfg-123' },
  detailData: { serial_number: '123456', caliber_id: 'cal-123' }
}

stdout | src/services/category/__tests__/FirearmsService.test.ts > FirearmsService > should handle serial numbers
[firearm_detailsService] Creating: {
  baseData: { name: 'Test Pistol' },
  detailData: { serial_number: 'ABC123' }
}

 × src/services/category/__tests__/FirearmsService.test.ts > FirearmsService > should create firearm with correct fields
   → Failed to create inventory item: undefined
 × src/services/category/__tests__/FirearmsService.test.ts > FirearmsService > should handle serial numbers
   → Failed to create inventory item: undefined
stdout | src/services/category/__tests__/AmmunitionService.test.ts > AmmunitionService > createAmmunition > should create ammunition with correct fields
[ammunition_detailsService] Creating: {
  baseData: { name: 'Test Ammo', manufacturer_id: 'mfg-456' },
  detailData: { caliber_id: 'cal-456', bullet_weight: 115 }
}

 × src/services/category/__tests__/AmmunitionService.test.ts > AmmunitionService > createAmmunition > should create ammunition with correct fields
   → Failed to create inventory item: undefined
 × src/services/category/__tests__/AmmunitionService.test.ts > AmmunitionService > createAmmunition > should handle bullet weight
   → Failed to create inventory item: undefined
stdout | src/services/category/__tests__/AmmunitionService.test.ts > AmmunitionService > createAmmunition > should handle bullet weight
[ammunition_detailsService] Creating: { baseData: { name: 'Test Ammo' }, detailData: { bullet_weight: 115 } }

